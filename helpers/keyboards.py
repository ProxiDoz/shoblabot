#!/usr/bin/python3.8.9
# -*- coding: utf-8 -*-
import telebot                      # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ piTelegramBotAPI
import secret                       # –§–∞–π–ª —Å —Ç–æ–∫–µ–Ω–∞–º–∏
from helpers import service_func    # –§–∞–π–ª —Å–æ —Å–ª—É–∂–µ–±–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

# –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∫ –Ω–∏–º
cool_guys = telebot.types.InlineKeyboardButton(text='üõ†–ü–æ–ª–µ–∑–Ω—ã–µ –ª—é–¥–∏', url='https://docs.google.com/spreadsheets/d/1-0wBt89xTOXyCcmLLesnWnMxZPsL3j6gRMz9l60MKt4/edit')
discord_link = telebot.types.InlineKeyboardButton(text='üéß–ù–∞—à Discord', url='https://discord.gg/sDKJSg2d9q')
signal_link = telebot.types.InlineKeyboardButton(text='üìü–ù–∞—à Signal', url='https://signal.group/#CjQKIIGG0r5wKd81QpgnP-EpeYa2W7zHdbIxK80HwzQWmLFqEhCiyeF6zPiQ0n-2D__7vMaj')
film_photo = telebot.types.InlineKeyboardButton(text='üì∏–®–æ–±–ª–∞ –≤ –ø–ª—ë–Ω–∫–µ', url='https://t.me/c/1126587083/247976')
help_keyboard = telebot.types.InlineKeyboardMarkup(row_width=2)
help_keyboard.add(cool_guys, discord_link, signal_link, film_photo)

# –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ inline-–∫–Ω–æ–ø–∫–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–ø—Ä–æ—Å–∞
wrong_stop = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ä–æ—Å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –µ–≥–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å‚òùÔ∏è'

# –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ –∫–æ–º–∞–Ω–¥–µ /discount
buttons = {0: ['üÜó –û–∫–µ–π', 'üéó –õ–µ–Ω—Ç–∞', '‚ùé –ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫', '5Ô∏è‚É£ –ü—è—Ç–µ—Ä–∫–∞', 'üß≤ –ú–∞–≥–Ω–∏—Ç', 'üõí –î–∏–∫—Å–∏', 'üõí –ê—à–∞–Ω', 'üõí –í–µ—Ä–Ω—ã–π', 'ü•ê –ë—É—à–µ'],
           1: ['disc_0', 'disc_1', 'disc_2', 'disc_3', 'disc_4', 'disc_5', 'disc_6', 'disc_7', 'disc_8'],
           2: ['üÜó [–û–∫–µ–π](https://i.imgur.com/zhx9CkA.png)',
               'üéó [–õ–µ–Ω—Ç–∞](https://i.imgur.com/SVq4ILS.png)',
               '‚ùé [–ü–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫](https://i.imgur.com/5wra693.png)',
               '5Ô∏è‚É£ [–ü—è—Ç–µ—Ä–∫–∞](https://i.imgur.com/9sJyYcx.png)',
               'üß≤ [–ú–∞–≥–Ω–∏—Ç](https://i.imgur.com/cbVdBnv.png)',
               'üõí [–î–∏–∫—Å–∏](https://i.imgur.com/FIQdWAh.png)',
               'üõí [–ê—à–∞–Ω](https://i.imgur.com/iGsQ2Ds.jpg)',
               'üõí [–í–µ—Ä–Ω—ã–π](https://i.imgur.com/Dxg7owo.png)',
               'ü•ê [–ë—É—à–µ](https://i.imgur.com/H6ins0K.jpg)']}

# –ù–∞—á–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ —Å–∫–∏–¥–∫–∞–º–∏
keyboard_start = telebot.types.InlineKeyboardMarkup(row_width=2)
keyboard_start.add(telebot.types.InlineKeyboardButton(text='‚óÄÔ∏è '+buttons[0][0], callback_data=buttons[1][0]),
                   telebot.types.InlineKeyboardButton(text='‚ñ∂Ô∏è '+buttons[0][2], callback_data=buttons[1][2]))


# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ callback_data
def button_func(bot, call):
    try:
        stop_poll(bot, call) if call.data[0:4] == 'stop' else edit_discount(bot, call)  # –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–ø—Ä–æ—Å–∞ –∏–ª–∏ —Å–º–µ–Ω—ã —Å–∫–∏–¥–∫–∏
    except Exception as button_func_error:
        service_func.send_error(bot, call.message, 21, button_func_error)


# –§—É–Ω–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ –ø–æ –∫–Ω–æ–ø–∫–µ
def edit_discount(bot, call):
    try:
        discount_id = int(call.data.split('_')[1])
        keyboard_update = telebot.types.InlineKeyboardMarkup(row_width=2)
        keyboard_update.add(telebot.types.InlineKeyboardButton(text='‚óÄÔ∏è '+buttons[0][discount_id - 1], callback_data=buttons[1][discount_id - 1]),
                            telebot.types.InlineKeyboardButton(text='‚ñ∂Ô∏è '+buttons[0][(discount_id + 1) % 9], callback_data=buttons[1][(discount_id + 1) % 9]))
        text = buttons[2][discount_id]
        bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id, text=text, parse_mode='Markdown', reply_markup=keyboard_update)
    except Exception as edit_discount_error:
        service_func.send_error(bot, call.message, 36, edit_discount_error)


# –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–ø—Ä–æ—Å–∞
def stop_poll(bot, call):
    try:
        message_id, user_id = call.data[5:].split('_')
        bot.stop_poll(secret.shobla_id, int(message_id)) if call.from_user.id == int(user_id) else bot.answer_callback_query(call.id, wrong_stop, show_alert=True)
    except Exception as stop_poll_error:
        service_func.send_error(bot, call.message, 22, stop_poll_error)
